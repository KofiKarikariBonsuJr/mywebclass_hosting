# Caddy Configuration for Educational Web Hosting
# This file defines how traffic is routed to different applications

# Global options (must be first!)
{
    # Email for Let's Encrypt notifications
    email admin@mywebclass.org
    
    # Default SNI (Server Name Indication)
    default_sni www.mywebclass.org
}

# Main website - www.mywebclass.org
www.mywebclass.org, mywebclass.org {
    # Reverse proxy to the main website container
    reverse_proxy main-site:80
    
    # Security headers
    header {
        # Prevent embedding in frames (clickjacking protection)
        X-Frame-Options "DENY"
        # Prevent MIME type sniffing
        X-Content-Type-Options "nosniff"
        # Enable XSS protection
        X-XSS-Protection "1; mode=block"
        # Force HTTPS
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    }
    
    # Enable compression
    encode gzip
    
    # Log access for monitoring
    log {
        output file /var/log/caddy/mywebclass.log {
            roll_size 10MB
            roll_keep 5
        }
    }
}

# Example student site
# student1.mywebclass.org {
#     reverse_proxy student1-app:80
#     encode gzip
# }

# Example API endpoint  
# api.mywebclass.org {
#     reverse_proxy api-service:3000
#     encode gzip
# }

# Caddy admin endpoint (for management)
# Uncomment for admin access - secure this properly in production
# admin.mywebclass.org {
#     reverse_proxy localhost:2019
#     basicauth {
#         admin $2a$14$hashed_password_here
#     }
# }

# Additional configuration notes:
# 1. Add new sites by copying the main site block
# 2. Change the domain and container name  
# 3. Reload with: docker compose exec caddy caddy reload --config /etc/caddy/Caddyfile
# 4. SSL certificates are automatically managed by Let's Encrypt